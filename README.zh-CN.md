# Nexus Social 🎲 - 一个解决真实问题的故事

> *最好的创意，往往源于最切身的体会。*

这个项目的想法，并非诞生于一次头脑风暴，而是源于我的女朋友。她是一个非常活跃的 Web3 社区成员，经常参与各种线上活动。在陪伴她的过程中，我发现这些活动总是伴随着混乱和挫败感。

在一次社区的拼图比赛中，场面非常典型：有人不知道怎么开始，有人选错了拼图，还有人完成了拼图但忘记截图发送到 Discord。最离谱的是，甚至有人直接修改代码，在几秒钟内就“完成”了比赛。作为一名产品经理，我对这些场景有着职业的敏感。我当时就在想：“如果有一个一站式的平台，能够解决所有这些问题，会怎么样？”

这便是 Nexus Social 最初的种子。

我是在2024年12月7日加入 Zama 社区的，从那时起便一直关注着这项技术。我一直想为 Zama 的开发者活动做点什么，却迟迟没有等到那个“对的”创意。直到我目睹了女友参与社区活动的全过程，那个“灵光乍现”的时刻终于到来了。我意识到，FHE 技术在处理隐藏信息游戏（如卡牌游戏）上的天然优势，正是构建一个真正可信的社交游戏平台的完美技术方案。

---

## 🚀 线上 Demo 与联系方式

-   **线上 Dapp**: [**https://nexus-social-dapp.vercel.app/**](https://nexus-social-dapp.vercel.app/)
-   **创始人 X/Twitter**: [@Elf_YuSheng](https://x.com/Elf_YuSheng)
-   **Sepolia 智能合约地址**: [`0xc82996db14d66c70586E1670d44A0E89cED4aced`](https://sepolia.etherscan.io/address/0xc82996db14d66c70586E1670d44A0E89cED4aced)

---

## 🎯 愿景：一个可持续的 Web3 社交中心

**Nexus Social** 不仅仅是一款游戏，它是一个为 Web3 社区量身定做的 **“社交活动即服务” (Social-Event-as-a-Service)** 平台。我们的使命是为社区管理者提供一个强大的工具，以增强成员的参与感，并为他们创造持久的价值。

### 我们解决的问题
加密社区依赖活动来提升参与度，但始终面临着：
1.  **📊 数据与公平性问题**: 手动统计结果不仅容易出错，还会引发关于公平性的争论，损害社区信任。
2.  **💎 价值无法沉淀**: 用户的参与和成就，在活动结束后便烟消云散。他们的贡献没有被记录，价值被忽视。
3.  **🧩 体验过于碎片化**: 不同的社区使用不同的平台，强迫用户不断学习新工具，也割裂了他们的链上身份。

### 我们的解决方案与策略
-   **🧩 一站式游戏中心**: 我们提供一个统一、简洁、方便的平台，适用于所有社区活动。这降低了参与门槛，创造了无缝的用户体验。
-   **📈 可追溯的贡献**: 所有游戏行为都被记录在链上，创造了透明、不可篡改的贡献证明，并逐步构建用户的链上声誉。
-   **🌐 可持续的增长模型**: 我们的增长与整个 Web3 生态的健康度息息相关，而非依赖自身代币的炒作周期。只要社区需要举办活动，Nexus Social 就有其价值。未来，我们将通过比赛抽成和广告收入实现商业化，创建一个有韧性的商业模式。
-   **🔐 FHE 驱动的公平性**: 借助 Zama 的 FHE 技术 (特别是 `FHE.eq` 函数)，我们得以实现“链上机密裁判”，在完全保护隐私的前提下，确保游戏逻辑的绝对公平。这是我们平台信任的基石。

> 想了解更多关于我们的产品策略、用户画像、商业模式和未来路线图的详细信息，请查阅完整的**[产品需求文档 (PRD)](./需求文档-Nexus%20Social.md)**。

---

## 🃏 关于 MVP: 首款游戏 Dark Cards

为了验证 **Nexus Social** 作为社交活动平台的核心价值，我们的 MVP (最小可行化产品) 聚焦于平台的第一款游戏 **Dark Cards**。这是一款经典的社交推理游戏，完美地展示了 FHE 技术如何解决链上游戏的信任问题。

### 游戏玩法：完整规则
“Dark Cards” 的灵魂在于信息不对称和玩家间的心理博弈。
-   **游戏目标**: 成为第一个出完所有手牌的玩家。
-   **核心流程**:
    1.  **出牌与宣称**: 玩家轮流打出 **1-N 张背面向上的牌**，并**公开宣称**这些牌是什么 (例如“我打了两张 K”)。你可以说真话，也可以说谎。
    2.  **挑战或信任**: 其他任何玩家都可以选择**“挑战”**你的宣称。如果没有人挑战，游戏继续。
    3.  **链上裁决**: 一旦发生“挑战”，智能合约将作为“机密裁判”，利用 FHE 技术在不泄露任何人底牌的情况下，公开裁决宣称是否属实。
        -   **挑战成功** (宣称为谎言): 叫牌方将输掉并收回牌桌上的所有牌。
        -   **挑战失败** (宣称为真话): 挑战方将输掉并收回牌桌上的所有牌。

### MVP 版本：极简体验
为了让用户能最直接地体验到 FHE 带来的“机密裁决”核心乐趣，我们对 MVP 版本进行了极致简化：
-   **模式**: 这是一个**单人挑战模式**，玩家的对手是系统（智能合约）。
-   **流程**:
    1.  **系统宣称**: 系统会自动在链上公开一个“宣称”(例如“我出了一张 A”)。
    2.  **玩家挑战**: 玩家界面上只有一个核心按钮：**“挑战！”**。
    3.  **即时裁决**: 点击后，智能合约将立即使用 FHE 逻辑进行验证，并将结果（系统是否说谎）透明地返回给玩家。

这个简化的 MVP 旨在清晰地展示我们产品的核心技术优势和未来多人在线社交体验的巨大潜力。

---

## 🔐 FHE 技术架构：如何实现机密公平性

### 核心创新：链上机密比较

Nexus Social 信任模型的核心是 Zama 的**全同态加密 (FHE)** 技术。我们的实现展示了一个从客户端加密到链上机密计算的完整 FHE 工作流程。

### 📊 我们架构中的 FHE 实现

#### 1. **客户端加密** (前端)
```typescript
// 用户的真实卡牌在客户端被加密
const input = fhevmInstance.createEncryptedInput(CONTRACT_ADDRESS, userAddress);
input.add8(realCard);  // 加密卡牌数值 (1-13)
const encryptedData = await input.encrypt();
```

**这里发生了什么：**
- 真实的卡牌数值在发送到区块链**之前**被加密成密文
- 生成一个零知识证明来验证加密的有效性
- **隐私保证**：明文永远不会离开用户的浏览器

#### 2. **链上机密计算** (智能合约)
```solidity
// TheBlindArbiter.sol - FHE "比较器"在行动
euint8 realCard = FHE.fromExternal(encryptedRealCard, proof);
ebool wasBluff = FHE.ne(realCard, FHE.asEuint8(claimedCard));
```

**这里发生了什么：**
- `FHE.fromExternal()`：验证零知识证明并将密文转换为内部加密类型
- `FHE.ne()`：在**加密空间中执行"不相等"比较** - 这是核心的 FHE 魔法！
- **关键创新**：智能合约比较两个数值**但从不解密它们**
- 区块链验证者和其他玩家都无法看到真实的卡牌数值

#### 3. **结果解密与 UX 决策** (前端)
```typescript
// 对于 MVP：前端直接计算结果
const wasBluff = gameData.real !== gameData.claimed;
```

**为什么我们在 MVP 中选择客户端结果展示：**

这是我们 MVP 阶段的一个**深思熟虑的设计决策**，平衡了技术完整性与开发速度和用户体验：

1. **MVP 上下文**：在我们简化的单人模式中，前端（充当"系统"角色）已经知道两个数值——这是 Demo 流程的一部分
2. **FHE 价值得以保留**：核心的 FHE 操作 (`FHE.ne()`) **仍然在链上执行**，提供了公平性的密码学证明。这满足了主要目标：**展示 FHE 执行机密比较的能力**
3. **生产路线图**：对于多人版本（2-10 名玩家），我们将实现**异步链上解密**，使用带有 KMS 回调的 `FHE.requestDecryption()`，确保结果完全去中心化

**链上证据**：每次挑战都会在 Sepolia 上生成可验证的 FHE 操作日志：
- `VerifyCiphertext`：证明验证 ✅
- `TrivialEncrypt`：加密声明 ✅
- `FheNe`：**机密比较** ✅
- `ChallengeResult`：交易成功 ✅

示例交易：[在 Sepolia 浏览器中查看](https://sepolia.etherscan.io/address/0xDC7c62E6b174DBB266E5C180AD20719E7636a16e)

### 🎯 为什么这个架构很重要

| 方面 | 传统方法 | 我们的 FHE 方法 |
|--------|---------------------|------------------|
| **卡牌隐私** | 以明文形式存储在链上（所有人可见） | 在链上加密（不透明的密文） |
| **比较逻辑** | 需要先解密，然后比较 | 在**加密状态下比较** |
| **信任模型** | 信任合约代码 | 信任 + 密码学证明 |
| **作弊防范** | 仅代码逻辑 | 数学上不可能 |

### 🔬 技术深入探讨

**使用的 FHE 类型：**
- `euint8`：加密的 8 位无符号整数（用于卡牌数值 1-13）
- `ebool`：加密的布尔值（用于比较结果）
- `externalEuint8`：外部加密输入结构（带有零知识证明）

**展示的 FHE 操作：**
- `FHE.fromExternal()`：安全输入验证
- `FHE.asEuint8()`：明文到密文转换
- `FHE.ne()`：机密不等比较（我们的"首选武器"）
- `FHE.allow()`：解密权限的访问控制

**安全保证：**
- 🔒 卡牌数值在区块链存储中保持加密
- 🔒 比较发生在加密域中（同态属性）
- 🔒 只有授权地址可以请求解密
- 🔒 零知识证明防止无效输入

---

## 🛠️ 技术栈

-   **区块链**: Solidity, Hardhat
-   **机密计算**: Zama FHEVM (`@fhevm/solidity` v0.5.x), FHE Relayer SDK
-   **FHE 操作**: `FHE.ne()` (比较器), `FHE.fromExternal()` (输入验证)
-   **前端**: React, TypeScript, Vite
-   **钱包集成**: RainbowKit, Wagmi, Viem
-   **部署**: Vercel (前端), Sepolia 测试网 (智能合约)

---

## 🏃‍♂️ 本地运行指南

按照以下步骤，你可以在本地环境中设置并运行本项目。

### 环境准备

-   [Node.js](https://nodejs.org/en/) (推荐 v18 或更高版本)
-   [Yarn](https://yarnpkg.com/) 或 npm
-   一个加密钱包，如 MetaMask

### 安装与设置

1.  **克隆代码仓库:**
    ```bash
    git clone https://github.com/bananooo-zhang/nexus-social-dapp.git
    cd nexus-social-dapp
    ```

2.  **安装根目录依赖:**
    ```bash
    npm install
    ```

3.  **安装前端依赖:**
    ```bash
    cd frontend
    npm install
    cd ..
    ```

4.  **设置环境变量:**
    -   在根目录中，复制 `.env.example` 文件来创建一个 `.env` 文件:
        ```bash
        cp .env.example .env
        ```
    -   编辑 `.env` 文件，填入你的 Sepolia RPC URL 和用于部署的私钥。

### 运行项目

1.  **启动本地 Hardhat 节点:**
    ```bash
    npx hardhat node
    ```

2.  **部署智能合约到本地节点:**
    -   在**新的终端**窗口中运行:
    ```bash
    npx hardhat run scripts/deploy.ts --network localhost
    ```
    -   部署成功后，复制新生成的合约地址，并更新到 `frontend/src/App.tsx` 文件中。

3.  **启动前端应用:**
    ```bash
    cd frontend
    npm run dev
    ```
    -   现在，你可以通过 `http://localhost:5173` 访问应用了。

---

## 📂 项目结构

```
nexus-social-dapp/
├── contracts/
│   └── TheBlindArbiter.sol   # 游戏核心逻辑的智能合约
├── frontend/
│   ├── src/
│   │   ├── App.tsx           # Dark Cards 游戏页面组件
│   │   ├── LandingPage.tsx   # Nexus Social 的产品首页
│   │   └── main.tsx          # 应用入口，负责钱包与路由设置
├── scripts/
│   └── deploy.ts             # 智能合约部署脚本
├── .env.example              # 环境变量示例文件
├── hardhat.config.ts         # Hardhat 配置文件
├── PRD-Nexus-Social-EN.md    # 英文版产品需求文档
└── package.json              # 项目根依赖
```
